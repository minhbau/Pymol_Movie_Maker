<tool id="movie_maker_basic" name="Movie Maker Basic">
  <description>produces a basic pymol session for the creation of a protein ligand interaction movie with PyMol</description>
    <!-- Show Error messages in right sidebar -->
    <stdio>
        <!-- Anything other than zero is an error -->
        <exit_code range="1:" />
        <exit_code range=":-1" />
        <!-- In case the return code has not been set propery check stderr too -->
        <regex match="Error:" />
        <regex match="Exception:" />
    </stdio>
    <!-- old command structure: <command interpreter="bash">movie_maker_basic.sh '$input' '$residue_name' '$chain' '$colorblind_save.selection' '$output' '$output2'</command> -->
    <!-- use cheetah template engine for interpretation and decision making on variables instead of just bash -->
    <command>
      <![CDATA[
        bash /home/webservices/galaxy_project/galaxy-dist/tools/customTools/movie_maker/movie_maker_basic.sh
        '$input'
        '$residue_name'
        '$chain'
        '$colorblind_save.selection'
        '$output'
        '$output2'
        > /home/webservices/philipp/shell_log.log
        ]]>
  </command>
  <inputs>
    <param format="pdb" name="input" type="data" label="Source file"/>
    <param format="text" name="residue_name" size="3" type="text" label="Insert 3 letter ligand residue name">
        <validator type="regex" message="Wrong format! Please enter just 3 letters.">^[A-Z,a-z,0-9]{3}$</validator>
    </param>
    <param format="text" name="chain" size="1" type="text" label="Chain">
        <validator type="regex" message="Wrong format! Please enter just 1 letter.">^[A-Z,a-z]{1}$</validator>
    </param>
    <conditional name="colorblind_save">
        <param name="selection" type="select" label="Use colorblind save coloring">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </param>
    </conditional>
    <conditional name="advanced_options" >
        <param label="Use advanced options" name="advanced_mode" type="select">
            <option selected="True" value="defaults">Use basic mode</option>
            <option value="advanced">Use advanced mode</option>
        </param>>
        <when value="defaults"></when>
        <when value="advanced">
            <param name="binding_site_size" type="select" label="Define size of binding pocket">
                <option value="4.0">4.0 A</option>
                <option value="4.5">4.5 A</option>
                <option value="5.0" selected="True">5.0 A</option>
                <option value="5.5">5.5 A</option>
                <option value="6.0">6.0 A</option>
            </param>
            <param name="check_halogen_interaction" type="boolean" checked="false"
                   label="Display possible halogen interaction in binding site?"
                   truevalue="Yes" falsevalue="No">
            </param>
            <param name="water_in_binding_site" type="boolean" checked="false"
                   label="Display water in binding site?"
                   truevalue="Yes" falsevalue="No">
            </param>
            <param name="color_carbon" type="select" label="Color of ligand backbone">
                <option value="yellow">Yellow</option>
                <option value="grey">Grey</option>
                <option value="orange">Orange</option>
            </param>
        </when>
    </conditional>
  </inputs>
  <outputs>
    <data format="pse" name="output" />
    <data format="txt" name="output2" />
  </outputs>

  <help>

**What it does**

This tool creates a PyMol session, which can be used to produce a movie with PyMol.

**Input Parameter**

Following parameters should be entered to allow a flawless computation:

    pdb-file
    three letter code of ligand
    chain of the binding pocket in question
    selection which colorscheme to use

Example:
    1r4l.pdb
    XX5
    A
    Yes

**Output**

The tool produces two output files.
The pymol session (\*.pse) can be downloaded as pse file and loaded with pymol.
In addition a pymol script-file (\*.pml) which was used for the generation of the scenes in the pse file, can be downloaded separately.
Pymol script files can conveniently be executed via the commandline ind the graphical interface with the command

      \@scriptfile

**DEBUGGING**

      If there is no molecule present in the binding pocket, make sure you defined the correct ligand residue name, this script will already try to guess the chain identifier.
  </help>

</tool>
